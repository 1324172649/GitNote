###### 时间：2021年08月24号

###### 内容管理 - 群组管理CMS新开发 - 动态成员  需求梳理

##### 一、 功能梳理：

1. 

2. 

   

##### 二、业务梳理

1. 
2. 

##### 三、设计思路

1. 

   1.1 

2.  

   2.1 

      2.1.1  
      2.1.2  
3. 

4. 
   

##### 四、表设计

1. 群组扩展信息表 {domain}_group，新增字段 comments_num，as_num

   ```
   "ALTER TABLE {domain}_group ADD comments_num MEDIUMINT(9) UNSIGNED DEFAULT '0' ",
   "ALTER TABLE {domain}_group ADD as_num MEDIUMINT(9) UNSIGNED DEFAULT '0' ",
   ```

2. 群组每日汇总数据 

   ```
   CREATE TABLE IF NOT EXISTS `{domian}_group_stat_date` (
     `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
     `date` int(10) unsigned NOT NULL,
     `gid` char(16) NOT NULL,
     `members_num` mediumint(9) unsigned DEFAULT '0',
     `follows_num` mediumint(9) unsigned DEFAULT '0',
     `as_num` mediumint(9) unsigned DEFAULT '0',
     `comments_num` mediumint(9) unsigned DEFAULT '0',
     `create_at` int(11) NOT NULL,
     PRIMARY KEY (`id`),
     UNIQUE KEY `date_gid` (`date`,`gid`)
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8
   ```

3. 

##### 五、 数据同步 & 跑批脚本

1. {domain}_group表 新增字段 历史数据脚本： 
2. 定时任务每天凌晨执行，数据汇总写入{domain}_group_stat_date表



##### 六、 涉及接口

 接口文档 同步到虚拟机，运行  apidoc.sh 

1.老接口

    1.1 GET /api/communitys
    1.2 GET /api/community/:id
    1.3 POST  /api/group/groupextend


2.新接口

    2.1 获取置顶群组  GET /api/community/top

##### 七、 设计目标

1、满足业务上各个需求
2、性能上单接口响应时间<300ms