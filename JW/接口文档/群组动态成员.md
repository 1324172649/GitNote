###### 时间：2021年08月24号

###### 内容管理 - 群组管理CMS新开发 - 动态成员  需求梳理

##### 一、 功能梳理：

1. 系统管理->群组管理->群组编辑和新增 页面
新增【群组动态成员】按钮，并且目前此开关开启之后不能再被关闭。

2. 系统管理->群组管理->群组编辑和新增 页面
【群组动态成员】按钮开启之后，可选择动态对象，列表分为两个部分：我的团队、用户组。此列表中，已被选择的对象（我的团队/用户组）要显示选中状态。

3. 系统管理->群组管理->群组编辑 页面
原功能（管理员的添加/修改）逻辑不变。

4. 系统管理->群组管理->群组编辑 页面
展示当前群组已选择的动态成员。

5. web端->团队->群组详情 页面
展示当前群组的所有成员，即需要将团队/用户组中的用户展示出来，而不需要展示动态成员对象。

6. web端->团队->群组详情 页面
原功能（成员/管理员的添加/修改）逻辑不变。

7. App->群组->编辑群组 页面
展示当前群组是否已开启动态成员的开关，但并不允许对此开关进行任何操作。

8. app->群组->成员（成员搜索） 页面
展示已添加的动态成员对象和单个用户，如图六所示。
并且，此处成员的添加和移除，仅可对单个用户操作，不可操作动态成员对象。
   

##### 二、业务梳理

1. 系统管理->群组管理，群组新增和编辑时候，选择动态成员请求接口，获取当前可被选择的团队和用户组列表数据。

2. 系统管理->群组管理，群组新增和编辑时候，提交参数新增【群组动态成员 dynamic_mems 默认值为0】；新增群组分享范围

3. 


##### 三、设计思路

1. 

   1.1 

2.  

   2.1 

      2.1.1  
      2.1.2  
3. 

4. 
   

##### 四、表设计

1. 群组扩展信息表 {domain}_group，新增字段 comments_num，as_num

   ```
   "ALTER TABLE {domain}_group ADD comments_num MEDIUMINT(9) UNSIGNED DEFAULT '0' ",
   "ALTER TABLE {domain}_group ADD as_num MEDIUMINT(9) UNSIGNED DEFAULT '0' ",
   ```

2. 群组每日汇总数据 

   ```
   CREATE TABLE IF NOT EXISTS `{domian}_group_stat_date` (
     `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
     `date` int(10) unsigned NOT NULL,
     `gid` char(16) NOT NULL,
     `members_num` mediumint(9) unsigned DEFAULT '0',
     `follows_num` mediumint(9) unsigned DEFAULT '0',
     `as_num` mediumint(9) unsigned DEFAULT '0',
     `comments_num` mediumint(9) unsigned DEFAULT '0',
     `create_at` int(11) NOT NULL,
     PRIMARY KEY (`id`),
     UNIQUE KEY `date_gid` (`date`,`gid`)
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8
   ```

3. 

##### 五、 数据同步 & 跑批脚本

1. {domain}_group表 新增字段 历史数据脚本： 
2. 定时任务每天凌晨执行，数据汇总写入{domain}_group_stat_date表



##### 六、 涉及接口

 接口文档 同步到虚拟机，运行  apidoc.sh 

1.老接口

    1.1 GET /api/communitys
    1.2 GET /api/community/:id
    1.3 POST  /api/group/groupextend


2.新接口

    2.1 获取置顶群组  GET /api/community/top

##### 七、 设计目标

1、满足业务上各个需求
2、性能上单接口响应时间<300m